<!-- CUTE Plugin Cruisecontrol Autobuild delegate script -->
<project name="build-cute"
        default="build"
        basedir="cute">
	
	<property name="features.dir" value="cute_releng/results/dist/updateSite/features"/>
	<property name="plugins.dir" value="cute_releng/results/dist/updateSite/plugins"/>
	<!-- - - - - - - - - - - - - - - - - - 
          target: checkoutBaseBuilder                      
         - - - - - - - - - - - - - - - - - -->
	<target name="checkoutBaseBuilder" unless="builder.available">
		<mkdir dir="cute_releng/tools" />
		<cvs cvsroot=":pserver:anonymous@dev.eclipse.org:/cvsroot/eclipse" package="org.eclipse.releng.basebuilder" tag="RC2_34" dest="cute_releng/tools" />
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: init                      
         - - - - - - - - - - - - - - - - - -->
    <target name="init">
        <mkdir dir="${features.dir}"/>
		<mkdir dir="${plugins.dir}"/>
    </target>


	<target name="build" depends="clean, init, checkoutReleng">
		<available file="${basedir}/cute_releng/tools/org.eclipse.releng.basebuilder/plugins/org.eclipse.equinox.launcher.jar" property="builder.available"/>
		<antcall target="checkoutBaseBuilder"/>

		<java jar="${basedir}/cute_releng/tools/org.eclipse.releng.basebuilder/plugins/org.eclipse.equinox.launcher.jar" fork="true" 
			failonerror="true" dir="${basedir}/cute_releng" resultproperty="error">
			<arg line="-ws gtk -os linux -application org.eclipse.ant.core.antRunner" />
		</java>

		<copy todir="cute_releng/results/dist" 
			flatten="true">
			<fileset dir="cute_releng/results">
				<include name="I*/*.html"/>
				<include name="I*/*.txt"/>
				<include name="I*/*.zip"/>
				<include name="I*/*.tar.gz"/>
			</fileset>
		</copy>
		<copy todir="${features.dir}" flatten="true">
			<fileset dir="cute_releng/results">
				<include name="I*/updateSite/features/*.jar" />
			</fileset>
		</copy>
		<copy todir="${plugins.dir}" flatten="true">
			<fileset dir="cute_releng/results">
				<include name="I*/updateSite/plugins/*.jar" />
			</fileset>
		</copy>
		<property file="${basedir}/cute_releng/results/buildResults.props" />
		<condition property="failedTest">
			<not>
				<equals arg1="true" arg2="${ch.hsr.ifs.cutelauncher.test}"/>
			</not>
		</condition>
		<fail if="failedTest" message="Test failed"/>

		<condition property="failedBuild">
			<not>
				<equals arg1="0" arg2="${error}"/>
			</not>
		</condition>
		<fail if="failedBuild" message="Build failed"/>
	</target>

	<!-- - - - - - - - - - - - - - - - - - 
          target: checkoutReleng                      
         - - - - - - - - - - - - - - - - - -->
	<target name="checkoutReleng" depends="clean">
		<cvs cvsroot="cruisecontrol@wiki.ifs.hsr.ch:/home/cvs" command="co cute_releng" reallyquiet="true" />
	</target>


	<target name="clean">
		<delete dir="${basedir}/cute_releng/results"/>
	</target>
</project>